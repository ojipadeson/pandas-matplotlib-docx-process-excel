# 从表格中提取数据绘制成图表并生成word文档报告

## 使用pandas，matplotlib，docx库

## 基于python3.7.7

## 图表的分类

1. 多年比较趋势图:提取每年的数据，将每年的变化曲线画到一张图
2. 单线图:将整个数据按时间作图
3. 双y轴比较图:左侧和右侧有不同的y轴，将相同时间段内不同的数据做比较

## 程序结构

### 1. 读取表格

### 2. 提取多年比较趋势图的数据（数据1）

由于'data_手动'表格部位统一索引，所以使用对表格的切片来获取数据，相应数据要放置在指定位置：

1，2列：时间，水泥磨机开工率

4，5列：时间，水泥出货率

7，9列：时间，全国建筑钢材成交量

11，12列：时间，挖掘机工程量

14，15列：时间，螺纹表观消费

### 3. 数据1传入 ``multiple_lines(df, title, ylim)``作图

df只允许时间和数据为两列，无特定索引的pandas.DataFrame数据

title为标题字符串，与name_list挂钩，所有作图函数都有该要求

提取的时间数据为2015~2020，横坐标修改为了固定的‘月/日’格式

### 4. 提取单线图数据（数据2）

全部来自data_wind表格中

### 5. 数据2传入 ``one_line(df, title, xlim, ylim)``作图

xlim为列表，包含一个元素，表示作图的开始时间

ylim按需求修改

### 6. 对数据2需要的数据使用 ``calculate_th(df)``计算同比环比

包含两个返回值

### 7. 使用 ``double_y(df1, df2, title, ylim1, ylim2, flag, begin_date)``做双y轴比较图

flag = 0时为同比环比比较；flag = 1时为现货期货比较

begin_date为开始时间

### 8. 所有函数中都使用 ``judge_trend(df)``进行最近一次的趋势判断，结果将保存于图标的名称中，所有图片保存于 ``图片``文件夹中

### 9. 使用 ``extract()``函数获取每一张图的趋势，并将结论字符串保存在 ``quote_list[]``中

### 10. 使用 ``set_table_picture(row, line, read_path)``和 ``set_table_paragraph(row, line, paragraph)``将图片和趋势结论保存在指定的 ``test.docx``的表格中

## 待更新的内容

- 更多的自定义接口
- 增加``clf()``函数以减少维护过多的``figure``
- 数据提取的精简优化
- 传输到word中的快速逻辑
- 三种函数更高的可移植性

## 系统性问题

- 表格读取速度慢

## 更新日志

- 对表格的格式进行了修改，使其界面更为美观
- 调整了2020线的粗细，使其更显著
- 删除了所有图表标题
- 修复了一些趋势判断的bug

## 最后更新时间

2020.7.31

